<polymer-element name="fa-comic" attributes="type">
    <template>
        <link rel="stylesheet" href="../../styles/animate.css" noshim />
        <style>

            .comic {
                box-shadow: 0px 5px 15px #3999fc;
                border-radius: 6px;
            }
            .full {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                text-align: center;

            }

            .text {
                font-size: 20px;
                color: #333;
                text-shadow: 1px 1px 0 #b8ceff;
                font-size: 22px;
            }

            #img {
                margin-right: 100px;
                max-width: 100%;
                height: auto;
            }

            @media(max-width: 1200px) {
                #img {
                    margin: 10px;
                }
            }

        </style>

        <fa-center-content>
            <div layout vertical>
                <img id="img"
                    class="comic {{!loading ? 'animated fadeInUp' : ''}}"
                    src="/comics/{{loc}}/regular/{{type}}_{{index}}.jpg"
                    hidden?="{{loading}}"
                    on-load="{{onLoad}}" />

                <div hidden?="{{!loading}}">
                    <span class="text {{loading ? 'animated rubberBand infinite' : ''}}">Loading...</span>
                </div>

                <div class="text {{!loading ? 'animated fadeInLeftBig' : ''}}" hidden?="{{loading}}" >
                   #{{index}}
                </div>
            </div>
        </fa-center-content>

        <fa-img-nav on-previous="{{previous}}" on-next="{{next}}"></fa-img-nav>

    </template>
    <script>
        Polymer('fa-comic', {
            index : 0,
            loading : true,
            hash : [],
            loc : '',

            ready : function() {
                this.loc = this.type.toLowerCase();

                if( this.type == 'Fauna' ) {
                    if( window.MAX_FAUNA_IMG ) this.index = MAX_FAUNA_IMG;
                    this.hash = ['home', ''];
                } else if ( this.type == 'nuts' ) {
                    if( window.MAX_NUTS_IMG ) this.index = MAX_NUTS_IMG;
                    this.hash = ['nuts'];
                }
                
                $(window).on('hashchange', this.update.bind(this))
                this.update();
            },

            update : function() {
                var parts = window.location.hash.split('/');
                parts[0] = parts[0].replace(/#/g, '');

                if( this.hash.indexOf(parts[0]) == -1 ) return;

                if( parts.length > 1 && this.index != parts[1] ) {
                    this.index = parts[1];
                } else if( parts.length == 1 ) {
                    if( this.type == 'Fauna' ) {
                        this.index = MAX_FAUNA_IMG;
                    } else if ( this.type == 'nuts' ) {
                        this.index = MAX_NUTS_IMG;
                    }

                    this.loading = true;
                }
            },

            previous : function() {
                this.index--;
                if( this.index < 1 ) {
                    this.index = 1;
                    return;
                }
                this.loading = true;
                window.location.hash = this.hash[0]+'/'+this.index;
            },

            next : function() {
                this.index++;
                
                if( this.type == 'Fauna' && this.index > MAX_FAUNA_IMG ) {
                    this.index = MAX_FAUNA_IMG;
                    return;
                } else if ( this.type == 'nuts' && this.index > MAX_NUTS_IMG ) {
                    this.index = MAX_NUTS_IMG;
                    return;
                }

                this.loading = true;
                window.location.hash = this.hash[0]+'/'+this.index;
            },

            onLoad : function() {
                this.loading = false;
            }
        });
    </script>
</polymer-element>