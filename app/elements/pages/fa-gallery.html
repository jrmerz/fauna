<polymer-element name="fa-gallery">
    <template>
        <link rel="stylesheet" href="../../bower_components/animate-css/animate.css" noshim />
        <style>

            .comic {
                box-shadow: 0px 5px 15px #3999fc;
                border-radius: 6px;
                margin: 10px;
                cursor: pointer;
            }

        </style>

        <fa-center-content>
            <div style="width: 400px;">
                <div style="margin: auto">
                    <template repeat="{{index in gallaryArray}}">
                       <img 
                        class="comic animated flipInX" 
                        src="/comics/thumb/Fauna_{{index}}.jpg"
                        index="{{index}}"
                        on-tap="{{_goTo}}" />
                    </template>
                </div>
            </div>
        </fa-center-content>

        <fa-img-nav on-previous="{{previous}}" on-next="{{next}}"></fa-img-nav>

    </template>
    <script>
        Polymer('fa-gallery', {
            index : 0,
            hash : ['cartoons'],
            loading : '',

            gallaryArray : [],
            timers : [],

            ready : function() {
                $(window)
                    .on('hashchange', this.update.bind(this))
                this.update();
            },

            update : function() {
                var parts = window.location.hash.split('/');
                parts[0] = parts[0].replace(/#/g, '');

                if( parts[0] != this.hash[0] ) return;
                if( parts.length > 1 ) this.index = parseInt(parts[1]);


                this._checkLowBounds();
                this._checkHiBounds();

                this._clearTimers();
                this.gallaryArray = [];
                var c = 0;

                for( var i = (this.index-1) * 9; i < this.index * 9; i++ ) {
                    if( i >= MAX_IMG ) return;
                    this._addPic(i, c);
                    c++;
                }
            },

            _addPic : function(i, c) {
                this.timers.push(setTimeout(function(){
                    this.gallaryArray.push(i+1);
                }.bind(this), 100*c));
            },

            _clearTimers : function() {
                for( var i = 0; i < this.timers.length; i++ ) {
                    if( this.timers[i] != -1 ) clearTimeout(this.timers[i]);
                }
                this.timer = [];
            },

            _checkLowBounds : function() {
                if( this.index < 1 ) {
                    this.index = 1;
                    return false;
                }
                return true;
            },

            _checkHiBounds : function() {
                if( this.index > Math.ceil( MAX_IMG / 9 ) ) {
                    this.index = Math.ceil( MAX_IMG / 9 );
                    return false;
                }
                return true;
            },

            _goTo : function(e) {
                var index = e.currentTarget.getAttribute('index');
                window.location.hash = 'home/'+index;
            },

            previous : function() {
                this.index--;
                this._checkLowBounds();
                window.location.hash = this.hash[0]+'/'+this.index;
            },

            next : function() {
                this.index++;
                this._checkHiBounds();
                window.location.hash = this.hash[0]+'/'+this.index;
            }
        });
    </script>
</polymer-element>